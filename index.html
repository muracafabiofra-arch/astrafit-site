<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Astra Fit AI</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; padding: 20px; }
    h1 { color: #222; }
    .box { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    input, textarea, button { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #ccc; }
    button { background: #222; color: white; cursor: pointer; }
    button:hover { background: #444; }
    .chat-box { max-height: 250px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; border-radius: 5px; background: #fff; }
    .user { font-weight: bold; color: #333; }
    .bot { color: #0077cc; }
  </style>
</head>
<body>

  <h1>Astra Fit AI ðŸ’ªðŸ¤–</h1>

  <!-- Generatore piano di allenamento -->
  <div class="box">
    <h2>Piano di allenamento</h2>
    <input type="text" id="goal" placeholder="Obiettivo (es: massa, definizione)">
    <input type="number" id="days" placeholder="Giorni a settimana">
    <button onclick="generatePlan()">Genera piano</button>
    <pre id="planResult"></pre>
  </div>

  <!-- Chat con Astra -->
  <div class="box">
    <h2>Chat con Astra AI</h2>
    <div class="chat-box" id="chatBox"></div>
    <textarea id="userInput" placeholder="Scrivi la tua domanda..."></textarea>
    <button onclick="sendMessage()">Invia</button>
  </div>

  <script>
    const API_BASE = "https://astra-fit-ai.fabiomuraca.workers.dev";

    // Genera piano di allenamento
    async function generatePlan() {
      const goal = document.getElementById("goal").value;
      const days = document.getElementById("days").value;

      const res = await fetch(`${API_BASE}/plan`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ goal, days })
      });

      const data = await res.json();
      document.getElementById("planResult").innerText = data.response || "Errore nel piano.";
    }

    // Chat con Astra
    async function sendMessage() {
      const input = document.getElementById("userInput").value;
      if (!input) return;

      const chatBox = document.getElementById("chatBox");
      chatBox.innerHTML += `<div class="user">Tu: ${input}</div>`;

      const res = await fetch(`${API_BASE}/api/chat`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: input })
      });

      const data = await res.json();
      const reply = data.response || "Errore risposta AI.";

      chatBox.innerHTML += `<div class="bot">Astra: ${reply}</div>`;
      document.getElementById("userInput").value = "";
      chatBox.scrollTop = chatBox.scrollHeight;
    }
  </script>

</body>
</html>
