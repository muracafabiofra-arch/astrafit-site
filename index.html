<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Astra Fit</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans">
  <div class="max-w-xl mx-auto p-4">

    <!-- Header -->
    <div class="bg-white rounded-2xl shadow p-6 mb-6 text-center">
      <div class="text-4xl mb-2">‚≠ê</div>
      <h1 class="text-2xl font-bold">Astra Fit</h1>
      <p class="text-gray-600">Calcolo del fabbisogno, macro, allenamento e assistenza AI.</p>
      <p class="text-xs text-gray-400 mt-2">¬© Astra Fit ‚Ä¢ a cura di Fabio Muraca</p>
    </div>

    <!-- Calcolo calorie & macro -->
    <div class="bg-white rounded-2xl shadow p-6 mb-6">
      <h2 class="text-xl font-bold mb-4">Calcolo calorie & macro</h2>
      <form id="macroForm" class="space-y-3">
        <select id="sesso" class="w-full p-2 border rounded">
          <option>Maschio</option>
          <option>Femmina</option>
        </select>
        <input type="number" id="eta" placeholder="Et√† (anni)" class="w-full p-2 border rounded">
        <div class="flex space-x-2">
          <input type="number" id="peso" placeholder="Peso (kg)" class="w-1/2 p-2 border rounded">
          <input type="number" id="altezza" placeholder="Altezza (cm)" class="w-1/2 p-2 border rounded">
        </div>
        <select id="attivita" class="w-full p-2 border rounded">
          <option>Sedentario (1‚Äì2 allen./sett.)</option>
          <option>Moderato (3‚Äì4 allen./sett.)</option>
          <option>Intenso (5‚Äì6 allen./sett.)</option>
        </select>
        <select id="obiettivo" class="w-full p-2 border rounded">
          <option>Definizione (-500 kcal)</option>
          <option>Mantenimento</option>
          <option>Massa (+300 kcal)</option>
        </select>
        <input type="number" id="proteine" placeholder="Proteine (g/kg)" value="2" class="w-full p-2 border rounded">
        <button type="submit" class="w-full bg-black text-white p-2 rounded">Calcola</button>
      </form>
      <div id="risultato" class="mt-4 text-sm text-gray-700"></div>
    </div>

    <!-- Piano di allenamento -->
    <div class="bg-white rounded-2xl shadow p-6 mb-6">
      <h2 class="text-xl font-bold mb-4">Piano di allenamento</h2>
      <input type="text" id="obiettivoAllenamento" placeholder="Obiettivo (es: massa, definizione)" class="w-full p-2 border rounded mb-2">
      <input type="number" id="giorniAllenamento" placeholder="Giorni a settimana" class="w-full p-2 border rounded mb-2">
      <button onclick="generaPiano()" class="w-full bg-black text-white p-2 rounded">Genera piano</button>
      <div id="pianoRisultato" class="mt-4 text-sm text-gray-700"></div>
    </div>

    <!-- Chat con AI -->
    <div class="bg-white rounded-2xl shadow p-6">
      <h2 class="text-xl font-bold mb-4">Chat con Astra AI ü§ñ</h2>
      <div id="chatBox" class="h-64 overflow-y-auto border p-3 rounded mb-3 bg-gray-50"></div>
      <div class="flex space-x-2">
        <input type="text" id="userInput" placeholder="Scrivi la tua domanda..." class="flex-1 p-2 border rounded">
        <button onclick="inviaMessaggio()" class="bg-black text-white px-4 rounded">Invia</button>
      </div>
    </div>

  </div>

  <script>
    // Calcolo calorie e macro
    document.getElementById("macroForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const peso = parseFloat(document.getElementById("peso").value);
      const altezza = parseFloat(document.getElementById("altezza").value);
      const eta = parseFloat(document.getElementById("eta").value);
      const sesso = document.getElementById("sesso").value;
      const attivita = document.getElementById("attivita").value;
      const obiettivo = document.getElementById("obiettivo").value;
      const proteine = parseFloat(document.getElementById("proteine").value);

      let bmr = sesso === "Maschio"
        ? 10*peso + 6.25*altezza - 5*eta + 5
        : 10*peso + 6.25*altezza - 5*eta - 161;

      let fattore = attivita.includes("Moderato") ? 1.55 : attivita.includes("Intenso") ? 1.75 : 1.2;
      let tdee = bmr * fattore;
      if (obiettivo.includes("Definizione")) tdee -= 500;
      if (obiettivo.includes("Massa")) tdee += 300;

      let kcal = Math.round(tdee);
      let pro = Math.round(proteine * peso);
      let fat = Math.round((0.8 * peso));
      let carb = Math.round((kcal - (pro*4 + fat*9)) / 4);

      document.getElementById("risultato").innerHTML =
        `<b>Fabbisogno:</b> ${kcal} kcal<br>
         Proteine: ${pro} g<br>
         Grassi: ${fat} g<br>
         Carboidrati: ${carb} g`;
    });

    // Piano allenamento (mock)
    function generaPiano() {
      const obiettivo = document.getElementById("obiettivoAllenamento").value;
      const giorni = document.getElementById("giorniAllenamento").value;
      document.getElementById("pianoRisultato").innerHTML =
        `Piano generato per <b>${obiettivo}</b>, ${giorni} giorni a settimana.`;
    }

    // Chat AI con Worker
    async function inviaMessaggio() {
      const input = document.getElementById("userInput");
      const messaggio = input.value.trim();
      if (!messaggio) return;

      const chatBox = document.getElementById("chatBox");
      chatBox.innerHTML += `<div>üë§: ${messaggio}</div>`;

      input.value = "";

      try {
        const risposta = await fetch("https://astra-fit-ai.fabiomuraca.workers.dev/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: messaggio })
        });

        const data = await risposta.json();
        if (data.response) {
          chatBox.innerHTML += `<div>ü§ñ: ${data.response}</div>`;
        } else {
          chatBox.innerHTML += `<div>‚ö†Ô∏è Errore risposta AI</div>`;
        }
      } catch (err) {
        chatBox.innerHTML += `<div>‚ö†Ô∏è Errore connessione</div>`;
      }

      chatBox.scrollTop = chatBox.scrollHeight;
    }
  </script>
</body>
</html>
