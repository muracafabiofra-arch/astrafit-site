<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AstraFit</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f9; }
    header { background: #111; color: #fff; padding: 1rem; text-align: center; }
    section { padding: 1.5rem; margin: 1rem; background: #fff; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);}
    h2 { margin-top: 0; }
    input, select, button, textarea { width: 100%; padding: 0.7rem; margin: 0.5rem 0; border-radius: 6px; border: 1px solid #ccc; }
    button { background: #111; color: #fff; border: none; cursor: pointer; font-weight: bold; }
    button:hover { background: #333; }
    .chat-box { border: 1px solid #ccc; height: 200px; overflow-y: auto; padding: 0.5rem; background: #fafafa; border-radius: 6px; }
    .message { margin: 0.3rem 0; }
    .user { font-weight: bold; color: #111; }
    .ai { color: #0077cc; }
  </style>
</head>
<body>

  <header>
    <h1>AstraFit ðŸš€</h1>
    <p>Il tuo assistente fitness personale</p>
  </header>

  <!-- Calcolo calorie -->
  <section>
    <h2>Calcola le tue calorie</h2>
    <form id="calorie-form">
      <input type="number" id="peso" placeholder="Peso (kg)" required>
      <input type="number" id="altezza" placeholder="Altezza (cm)" required>
      <input type="number" id="eta" placeholder="EtÃ " required>
      <select id="genere">
        <option value="maschio">Maschio</option>
        <option value="femmina">Femmina</option>
      </select>
      <select id="attivita">
        <option value="1.2">Sedentario</option>
        <option value="1.55">Moderato</option>
        <option value="1.9">Intenso</option>
      </select>
      <button type="submit">Calcola</button>
    </form>
    <p id="risultato-calorie"></p>
  </section>

  <!-- Training -->
  <section>
    <h2>Piano di allenamento</h2>
    <form id="training-form">
      <input type="text" id="obiettivo" placeholder="Obiettivo (es: massa, definizione)" required>
      <input type="number" id="giorni" placeholder="Giorni a settimana" required>
      <button type="submit">Genera piano</button>
    </form>
    <div id="risultato-training"></div>
  </section>

  <!-- AI Assistant -->
  <section>
    <h2>Chat con Astra AI ðŸ¤–</h2>
    <div class="chat-box" id="chat-box"></div>
    <textarea id="user-input" placeholder="Scrivi la tua domanda..."></textarea>
    <button id="send-btn">Invia</button>
  </section>

  <script>
    // Calorie
    document.getElementById("calorie-form").addEventListener("submit", e => {
      e.preventDefault();
      const peso = parseFloat(document.getElementById("peso").value);
      const altezza = parseFloat(document.getElementById("altezza").value);
      const eta = parseInt(document.getElementById("eta").value);
      const genere = document.getElementById("genere").value;
      const attivita = parseFloat(document.getElementById("attivita").value);
      let bmr;
      if (genere === "maschio") {
        bmr = 10*peso + 6.25*altezza - 5*eta + 5;
      } else {
        bmr = 10*peso + 6.25*altezza - 5*eta - 161;
      }
      const tdee = Math.round(bmr * attivita);
      document.getElementById("risultato-calorie").textContent = "Fabbisogno giornaliero: " + tdee + " kcal";
    });

    // Training
    document.getElementById("training-form").addEventListener("submit", e => {
      e.preventDefault();
      const obiettivo = document.getElementById("obiettivo").value;
      const giorni = document.getElementById("giorni").value;
      document.getElementById("risultato-training").textContent =
        `Piano generato: ${giorni} sessioni settimanali per obiettivo ${obiettivo}.`;
    });

    // Chat AI
    const chatBox = document.getElementById("chat-box");
    document.getElementById("send-btn").addEventListener("click", async () => {
      const input = document.getElementById("user-input");
      const userMsg = input.value.trim();
      if (!userMsg) return;

      // mostra messaggio utente
      const userDiv = document.createElement("div");
      userDiv.className = "message user";
      userDiv.textContent = "ðŸ‘¤: " + userMsg;
      chatBox.appendChild(userDiv);

      // reset input
      input.value = "";

      // chiamata al Worker
      const aiDiv = document.createElement("div");
      aiDiv.className = "message ai";
      aiDiv.textContent = "ðŸ¤–: ...";
      chatBox.appendChild(aiDiv);

      try {
        const res = await fetch("https://astra-fit-ai.fabiomuraca.workers.dev/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: userMsg })
        });
        const data = await res.json();
        aiDiv.textContent = "ðŸ¤–: " + (data.reply || "Errore risposta AI");
      } catch (err) {
        aiDiv.textContent = "ðŸ¤–: Errore di connessione al server";
      }

      chatBox.scrollTop = chatBox.scrollHeight;
    });
  </script>
</body>
</html>
