<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Astra Fit</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f7;
      color: #111;
    }
    header {
      text-align: center;
      padding: 2rem 1rem 1rem;
    }
    header h1 {
      font-size: 1.8rem;
      font-weight: 700;
      margin: 0.5rem 0 0.3rem;
    }
    header p {
      font-size: 0.95rem;
      color: #444;
      margin: 0;
    }
    .card {
      background: #fff;
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1rem auto;
      max-width: 600px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }
    h2 {
      font-size: 1.2rem;
      margin-bottom: 1rem;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 0.75rem;
      margin: 0.4rem 0;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
    }
    button {
      background: #111;
      color: #fff;
      font-weight: 600;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #333;
    }
    .result {
      margin-top: 1rem;
      padding: 1rem;
      background: #f5f5f7;
      border-radius: 8px;
      font-size: 0.95rem;
      color: #111;
      white-space: pre-line;
    }
  </style>
</head>
<body>

  <header>
    <div style="font-size:2.5rem;">‚≠ê</div>
    <h1>Astra Fit</h1>
    <p>Calcolo del fabbisogno, macro, allenamento e assistenza AI.</p>
    <p style="font-size:0.85rem; color:#666;">¬© Astra Fit ‚Ä¢ a cura di Fabio Muraca</p>
  </header>

  <!-- Coach AI -->
  <div class="card">
    <h2>ü§ñ Coach AI</h2>
    <textarea id="userQuestion" placeholder="Scrivi la tua domanda di fitness..."></textarea>
    <button onclick="askAI()">Chiedi</button>
    <div id="aiResponse" class="result" style="display:none;"></div>
  </div>

  <!-- Calcolatore Calorie & Macro -->
  <div class="card">
    <h2>üî• Calcolo calorie & macro</h2>
    <label>Sesso</label>
    <select id="gender">
      <option value="male">Maschio</option>
      <option value="female">Femmina</option>
    </select>
    <label>Et√† (anni)</label>
    <input type="number" id="age">
    <label>Peso (kg)</label>
    <input type="number" id="weight">
    <label>Altezza (cm)</label>
    <input type="number" id="height">
    <label>Attivit√†</label>
    <select id="activity">
      <option value="1.2">Sedentario (1‚Äì2 allen./sett.)</option>
      <option value="1.55">Moderato (3‚Äì4 allen./sett.)</option>
      <option value="1.75">Intenso (5‚Äì6 allen./sett.)</option>
    </select>
    <label>Obiettivo</label>
    <select id="goal">
      <option value="-500">Definizione (-500 kcal)</option>
      <option value="0">Mantenimento</option>
      <option value="300">Massa (+300 kcal)</option>
    </select>
    <label>Proteine (g/kg)</label>
    <input type="number" id="protein" value="2">
    <button onclick="calculateCalories()">Calcola</button>
    <div id="calorieResult" class="result" style="display:none;"></div>
  </div>

  <!-- Training Planner -->
  <div class="card">
    <h2>üèãÔ∏è Training Planner</h2>
    <p style="font-size:0.9rem; color:#444;">Genera un piano di allenamento personalizzato con l'AI in base ai tuoi dati.</p>
    <button onclick="generateTraining()">Genera piano</button>
    <div id="trainingPlan" class="result" style="display:none;"></div>
  </div>

  <script>
    // === Coach AI ===
    async function askAI() {
      const question = document.getElementById("userQuestion").value.trim();
      const responseDiv = document.getElementById("aiResponse");
      if (!question) return;
      responseDiv.style.display = "block";
      responseDiv.textContent = "Sto pensando...";
      try {
        const res = await fetch("https://astra-fit-ai.fabiomuraca.workers.dev/ask", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question })
        });
        const data = await res.json();
        responseDiv.textContent = data.answer || "Errore nella risposta.";
      } catch {
        responseDiv.textContent = "Errore di connessione.";
      }
    }

    // === Calcolatore ===
    function calculateCalories() {
      const gender = document.getElementById("gender").value;
      const age = parseInt(document.getElementById("age").value);
      const weight = parseFloat(document.getElementById("weight").value);
      const height = parseFloat(document.getElementById("height").value);
      const activity = parseFloat(document.getElementById("activity").value);
      const goal = parseInt(document.getElementById("goal").value);
      const protein = parseFloat(document.getElementById("protein").value);

      if (!age || !weight || !height) {
        alert("Compila tutti i campi!");
        return;
      }

      let bmr;
      if (gender === "male") {
        bmr = 10 * weight + 6.25 * height - 5 * age + 5;
      } else {
        bmr = 10 * weight + 6.25 * height - 5 * age - 161;
      }

      const tdee = bmr * activity;
      const calories = tdee + goal;
      const proteins = protein * weight;
      const fats = (0.25 * calories) / 9;
      const carbs = (calories - (proteins * 4 + fats * 9)) / 4;

      document.getElementById("calorieResult").style.display = "block";
      document.getElementById("calorieResult").innerHTML = `
        üîπ Fabbisogno: <b>${Math.round(calories)}</b> kcal<br>
        üçó Proteine: <b>${Math.round(proteins)}</b> g<br>
        ü•ë Grassi: <b>${Math.round(fats)}</b> g<br>
        üçö Carboidrati: <b>${Math.round(carbs)}</b> g
      `;
    }

    // === Training Planner con AI ===
    async function generateTraining() {
      const age = document.getElementById("age").value;
      const weight = document.getElementById("weight").value;
      const activity = document.getElementById("activity").options[document.getElementById("activity").selectedIndex].text;
      const goal = document.getElementById("goal").options[document.getElementById("goal").selectedIndex].text;

      const prompt = `Genera un piano di allenamento settimanale per una persona di ${age} anni, ${weight} kg, livello: ${activity}, obiettivo: ${goal}. Usa un formato semplice e leggibile con giorni ed esercizi.`;

      const trainingDiv = document.getElementById("trainingPlan");
      trainingDiv.style.display = "block";
      trainingDiv.textContent = "Creo il tuo piano...";

      try {
        const res = await fetch("https://astra-fit-ai.fabiomuraca.workers.dev/ask", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question: prompt })
        });
        const data = await res.json();
        trainingDiv.textContent = data.answer || "Errore nella risposta.";
      } catch {
        trainingDiv.textContent = "Errore di connessione.";
      }
    }
  </script>

</body>
</html>
